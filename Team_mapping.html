<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Team Mapping</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        background-color: #f2f3f7;
      }
      h2 {
        color: #072d4e;
        margin: 0px 0px;
      }
      .search-bar {
        margin-bottom: 20px;
        height: 22px;
        width: 300px;
        margin-right: 20px;
        border-top-right-radius: 4px;
        border-bottom-right-radius: 4px;
        padding: 4px 8px;
        margin-left: -2px !important;
        border: 2px solid;
        border-left: none;
      }
      #orgTable {
        border-collapse: collapse;
        width: 100%;
        background-color: #fff;
      }
      #orgTable th,
      #orgTable td {
        border: 1px solid #d3d2d2;
        padding: 8px 12px;
        text-align: left;
        margin-bottom: 4px;
      }
      #orgTable th {
        background-color: #58be35;
        color: #0b1925;
      }
      #orgTable tr:nth-child(even) {
        background-color: #f6f8fc;
      }
      #orgTable tr.hide {
        display: none;
      }

      .input-legend {
        background-color: #b9703c;
        padding: 8px 10px 10px 10px;
        border: 1px solid;
        color: #fff;
        font-size: 14px;
        border-top-left-radius: 4px;
        border-bottom-left-radius: 4px;
      }
      .counts {
        padding: 10px;
        background-color: #fff;
        border-radius: 4px;
        box-shadow: 0px 0px 8px #00000011;
      }
      .counts span {
        font-size: 16px;
      }
      .header {
        background-color: #fff;
        padding: 16px 40px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      #dashboard {
        padding: 20px 40px;
      }
      .content {
        padding: 0px 40px;
      }
      .instruction {
        margin: 0;
        margin-top: 6px;
        color: #626263;
      }
      .Import-btn {
        padding: 8px 28px;
        font-size: 16px;
        background-color: #2e8e25;
        border: 1px solid #2e8e25;
        border-radius: 4px;
        font-weight: 600;
        color: #fffefe;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div>
        <h2>Team Mapping</h2>
        <p class="instruction">
          Please select the file from: z/scheduling/Team Mapping.
        </p>
      </div>
      <div class="upload-section">
        <input
          type="file"
          id="fileInput"
          accept=".xlsx, .xls"
          style="display: none"
        />
        <button
          type="button"
          class="Import-btn"
          onclick="document.getElementById('fileInput').click()"
        >
          Import File
        </button>
      </div>
    </div>
    <div id="dashboard" style="display: flex; gap: 2rem; margin-bottom: 10px">
      <div class="counts">
        <span>Analyst:</span> <strong id="analystCount">0</strong>
      </div>
      <div class="counts"><span>QC:</span> <strong id="qcCount">0</strong></div>
    </div>
    <div class="content">
      <span class="input-legend">Analyst</span
      ><input
        type="text"
        class="search-bar"
        id="universalInput"
        style="border-color: #b9703c"
        placeholder="Universal Search"
      />
      <span class="input-legend" style="background-color: #a53a67">QC</span>
      <input
        type="text"
        class="search-bar"
        id="qcInput"
        placeholder="Search QC"
        style="border-color: #a53a67; margin-left: -5px !important"
      />
      <table id="orgTable">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>

    <script>
      document
        .getElementById("fileInput")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          const reader = new FileReader();
          reader.onload = function (event) {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, { type: "array" });
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const json = XLSX.utils.sheet_to_json(worksheet, {
              header: 1,
              raw: false,
            });
            const table = document.getElementById("orgTable");
            const thead = table.querySelector("thead");
            const tbody = table.querySelector("tbody");
            thead.innerHTML = "";
            tbody.innerHTML = "";
            if (json.length > 0) {
              let thRow = "<tr><th>S. No.</th>";
              json[0].forEach((col) => (thRow += `<th>${col}</th>`));
              thRow += "</tr>";
              thead.innerHTML = thRow;

              for (let i = 1; i < json.length; i++) {
                let trRow = `<tr><td>${i}</td>`;
                json[i].forEach((cell) => {
                  trRow += `<td>${cell !== undefined ? cell : ""}</td>`;
                });
                trRow += "</tr>";
                tbody.innerHTML += trRow;
              }
              updateDashboard(json);
            }
          };
          reader.readAsArrayBuffer(file);
        });

      function searchTable() {
        const universalValue = document
          .getElementById("universalInput")
          .value.toLowerCase()
          .trim();
        const qcValue = document
          .getElementById("qcInput")
          .value.toLowerCase()
          .trim();
        const table = document.getElementById("orgTable");
        const rows = table.querySelectorAll("tbody tr");
        let visibleCount = 1;

        const universalTerms = universalValue
          .split(/\s+/)
          .filter((term) => term);

        rows.forEach((row) => {
          const cells = Array.from(row.cells);
          const qcCell = cells[3]?.textContent.toLowerCase() || "";

          const matchUniversal =
            universalTerms.length === 0 ||
            universalTerms.some((term) =>
              cells.some((cell) =>
                cell.textContent.toLowerCase().includes(term),
              ),
            );

          const matchQC = qcValue === "" || qcCell.includes(qcValue);

          if (matchUniversal && matchQC) {
            row.classList.remove("hide");
            row.cells[0].textContent = visibleCount++;
          } else {
            row.classList.add("hide");
            row.cells[0].textContent = "";
          }
        });
      }

      document
        .getElementById("universalInput")
        .addEventListener("input", searchTable);
      document.getElementById("qcInput").addEventListener("input", searchTable);
    </script>
  </body>
</html>
