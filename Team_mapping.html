<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Team Mapping</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        background-color: #f2f3f7;
      }
      h2 {
        color: #072d4e;
        margin: 0px 0px;
      }
      .search-bar {
        margin-bottom: 20px;
        height: 22px;
        width: 300px;
        margin-right: 20px;
        border-top-right-radius: 4px;
        border-bottom-right-radius: 4px;
        padding: 4px 8px;
        margin-left: -2px !important;
        border: 2px solid;
        border-left: none;
      }
      #orgTable {
        border-collapse: collapse;
        width: 100%;
        background-color: #fff;
      }
      #orgTable th,
      #orgTable td {
        border: 1px solid #d3d2d2;
        padding: 8px 12px;
        text-align: left;
        margin-bottom: 4px;
      }
      #orgTable th {
        background-color: #a79af3;
        color: #0b1925;
      }
      #orgTable tr:nth-child(even) {
        background-color: #f6f8fc;
      }
      #orgTable tr.hide {
        display: none;
      }

      .input-legend {
        background-color: #7a3aa5;
        padding: 8px 10px 10px 10px;
        border: 1px solid;
        color: #fff;
        font-size: 14px;
        border-top-left-radius: 4px;
        border-bottom-left-radius: 4px;
      }
      .counts {
        padding: 10px;
        background-color: #fff;
        border-radius: 4px;
        box-shadow: 0px 0px 8px #00000011;
      }
      .counts span {
        font-size: 16px;
      }
      .header {
        background-color: #fff;
        padding: 16px 40px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      #dashboard {
        padding: 20px 40px;
      }
      .content {
        padding: 0px 40px;
      }
      .instruction {
        margin: 0;
        margin-top: 6px;
        color: #626263;
      }
      .Import-btn {
        padding: 8px 28px;
        font-size: 16px;
        background-color: #0071db;
        border: 1px solid #034c91;
        border-radius: 4px;
        font-weight: 400;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div>
        <h2>Team Mapping</h2>
        <p class="instruction">
          Please select the file from: z/scheduling/Team Mapping.
        </p>
      </div>
      <div class="upload-section">
        <input
          type="file"
          id="fileInput"
          accept=".xlsx, .xls"
          style="display: none"
        />
        <button
          type="button"
          class="Import-btn"
          onclick="document.getElementById('fileInput').click();"
        >
          Import File
        </button>
      </div>
    </div>
    <div id="dashboard" style="display: flex; gap: 2rem; margin-bottom: 10px">
      <div class="counts">
        <span>Analysts:</span> <strong id="analystCount">0</strong>
      </div>
      <div class="counts">
        <span>QCs:</span> <strong id="qcCount">0</strong>
      </div>
      <div class="counts">
        <span>Hyderabad :</span> <strong id="hyderabadAnalystCount">0</strong>
      </div>
      <div class="counts">
        <span>Bengalore :</span> <strong id="bengaloreAnalystCount">0</strong>
      </div>
      <div class="counts">
        <span>Gurgaon :</span> <strong id="gurgaonAnalystCount">0</strong>
      </div>
      <div class="counts">
        <span>Israel :</span> <strong id="israelAnalystCount">0</strong>
      </div>
      <div class="counts">
        <span>sampling :</span> <strong id="samplingAnalystCount">0</strong>
      </div>
      <div class="counts">
        <span>10% :</span> <strong id="percent10">0</strong>
      </div>
      <div class="counts">
        <span>25% :</span> <strong id="percent25">0</strong>
      </div>
      <div class="counts">
        <span>50% :</span> <strong id="percent50">0</strong>
      </div>
      <div class="counts">
        <span>Total :</span> <strong id="totalCount">0</strong>
      </div>
    </div>
    <div class="content">
      <span class="input-legend">Analyst</span
      ><input
        type="text"
        class="search-bar"
        id="universalInput"
        style="border-color: #7a3aa5"
        placeholder="Universal Search"
      />
      <span class="input-legend" style="background-color: #a53a67">QC</span>
      <input
        type="text"
        class="search-bar"
        id="qcInput"
        placeholder="Search QC"
        style="border-color: #a53a67; margin-left: -5px !important"
      />
      <table id="orgTable">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>

    <script>
      document
        .getElementById("fileInput")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          const reader = new FileReader();
          reader.onload = function (event) {
            const data = new Uint8Array(event.target.result);
            const workbook = XLSX.read(data, { type: "array" });
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const json = XLSX.utils.sheet_to_json(worksheet, {
              header: 1,
              raw: false,
            });
            const table = document.getElementById("orgTable");
            const thead = table.querySelector("thead");
            const tbody = table.querySelector("tbody");
            thead.innerHTML = "";
            tbody.innerHTML = "";
            if (json.length > 0) {
              let thRow = "<tr><th>S. No.</th>";
              json[0].forEach((col) => (thRow += `<th>${col}</th>`));
              thRow += "</tr>";
              thead.innerHTML = thRow;

              for (let i = 1; i < json.length; i++) {
                let trRow = `<tr><td>${i}</td>`;
                json[i].forEach((cell) => {
                  trRow += `<td>${cell !== undefined ? cell : ""}</td>`;
                });
                trRow += "</tr>";
                tbody.innerHTML += trRow;
              }
              updateDashboard(json);
            }
          };
          reader.readAsArrayBuffer(file);
        });

      function updateDashboard(data) {
        if (!data || data.length < 2) return;
        const header = data[0];
        const analystIdx = header.indexOf("L1 Analyst");
        const qcIdx = header.indexOf("L1 QC ");
        const locationIdx = header.indexOf("Location");
        const caseTypeIdx = header.indexOf("Case Type");
        const samplingIdx = header.indexOf("Sampling Percentage");

        const analysts = new Set();
        const qcs = new Set();
        const analystLocation = {
          Hyderabad: new Set(),
          Gurgaon: new Set(),
          Bengalore: new Set(),
        };

        let samplingAnalysts = new Set();
        const samplingPercentCounts = { "50%": 0, "25%": 0, "10%": 0 };
        for (let i = 1; i < data.length; i++) {
          const row = data[i];

          if (row[analystIdx]) analysts.add(row[analystIdx].trim());
          if (row[qcIdx]) qcs.add(row[qcIdx].trim());
          if (row[locationIdx] && row[analystIdx]) {
            const loc = row[locationIdx].trim().toLowerCase();
            if (loc === "hyderabad")
              analystLocation.Hyderabad.add(row[analystIdx].trim());
            if (loc === "gurgaon")
              analystLocation.Gurgaon.add(row[analystIdx].trim());
            if (loc === "bengalore")
              analystLocation.Bengalore.add(row[analystIdx].trim());
            if (loc === "isreal")
              analystLocation.Bengalore.add(row[analystIdx].trim());
          }

          if (
            row[caseTypeIdx] &&
            row[caseTypeIdx].toLowerCase().includes("sampling")
          ) {
            if (row[analystIdx]) samplingAnalysts.add(row[analystIdx].trim());
          }

          if (row[samplingIdx]) {
            const percent = row[samplingIdx].trim();
            if (["50%", "25%", "10%"].includes(percent)) {
              samplingPercentCounts[percent]++;
            }
          }
        }
        document.getElementById("analystCount").textContent = analysts.size;
        document.getElementById("qcCount").textContent = qcs.size;
        document.getElementById("hyderabadAnalystCount").textContent =
          analystLocation.Hyderabad.size;
        document.getElementById("gurgaonAnalystCount").textContent =
          analystLocation.Gurgaon.size;
        document.getElementById("bengaloreAnalystCount").textContent =
          analystLocation.Bengalore.size;
        document.getElementById("israelAnalystCount").textContent =
          analystLocation.Bengalore.size;
        document.getElementById("samplingAnalystCount").textContent =
          samplingAnalysts.size;

        document.getElementById("percent50").textContent =
          samplingPercentCounts["50%"];
        document.getElementById("percent25").textContent =
          samplingPercentCounts["25%"];
        document.getElementById("percent10").textContent =
          samplingPercentCounts["10%"];
        document.getElementById("totalCount").textContent =
          analysts.size + qcs.size;
      }

      function searchTable() {
        const universalValue = document
          .getElementById("universalInput")
          .value.toLowerCase()
          .trim();
        const qcValue = document
          .getElementById("qcInput")
          .value.toLowerCase()
          .trim();
        const table = document.getElementById("orgTable");
        const rows = table.querySelectorAll("tbody tr");
        let visibleCount = 1;

        const universalTerms = universalValue
          .split(/\s+/)
          .filter((term) => term);

        rows.forEach((row) => {
          const cells = Array.from(row.cells);
          const qcCell = cells[3]?.textContent.toLowerCase() || "";

          const matchUniversal =
            universalTerms.length === 0 ||
            universalTerms.some((term) =>
              cells.some((cell) =>
                cell.textContent.toLowerCase().includes(term)
              )
            );

          const matchQC = qcValue === "" || qcCell.includes(qcValue);

          if (matchUniversal && matchQC) {
            row.classList.remove("hide");
            row.cells[0].textContent = visibleCount++;
          } else {
            row.classList.add("hide");
            row.cells[0].textContent = "";
          }
        });
      }

      document
        .getElementById("universalInput")
        .addEventListener("input", searchTable);
      document.getElementById("qcInput").addEventListener("input", searchTable);
    </script>
  </body>
</html>
