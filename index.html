<!-- Code Generated by Sidekick is for learning and experimentation purposes only. -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

    <meta charset="UTF-8" />
    <title>Case ID Folder Creator</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: Arial, sans-serif;
        background-color: #000;
        width: 100%;
      }
      .container {
        width: 100%;
        display: flex;
        padding: 20px;
        gap: 20px;
      }
      .form-card {
        width: fit-content;
        padding: 20px;
        background-color: #191919;
        border: 1px solid #373737;
        backdrop-filter: blur(16px);
        border-radius: 8px;
      }
      h2 {
        margin-bottom: 20px;
        color: #ffffff;
      }
      label,
      input,
      select,
      button {
        display: block;
        color: #ffffff;
      }
      .case-input {
        background-color: #373737;
        color: #ffffff;
        width: calc(100% - 35px);
        padding: 10px 16px;
        border-radius: 6px;
        margin-bottom: 25px;
        margin-top: 10px;
        font-size: 16px;
        border: 1px solid #191919;
      }

      .counterpartyCheckbox {
        display: inline-block;
        margin: 0px;
      }

      input:focus,
      select:focus {
        border-color: #54932e;
      }
      .formbtns {
        background-color: #54932e;
        color: #ffffff;
        width: 100%;
        font-size: 14px;
        font-weight: 600;
        border: none;
        padding: 10px;
        border-radius: 4px;
      }
      .radio-btn-parent {
        display: flex;
        margin-top: 16px;
        margin-bottom: 20px;
      }
      .radio-btn-parent label {
        margin-left: 4px;
        margin-right: 20px;
      }
      .success {
        background: #4caf5036;
        padding: 10px;
        color: #61f707;
        margin-top: 15px;
        border-radius: 4px;
        border: 2px solid #327535;
      }
      .error {
        background: #af4c4c36;
        padding: 10px;
        color: #f70707;
        margin-top: 15px;
        border-radius: 4px;
        border: 2px solid #753232;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="form-card">
        <h2>Create Case Folder</h2>
        <label for="caseId">Enter Case ID:</label>
        <input
          type="text"
          class="case-input"
          id="caseId"
          placeholder="Case ID"
          required
        />

        <label for="counterParty">Is counter party available?</label>
        <div class="radio-btn-parent">
          <input
            type="radio"
            class="counterpartyCheckbox"
            id="counterPartyYes"
            name="counterParty"
            value="yes"
          />
          <label for="counterPartyYes">Yes</label>
          <input
            class="counterpartyCheckbox"
            type="radio"
            id="counterPartyNo"
            name="counterParty"
            value="no"
            checked
          />
          <label for="counterPartyNo">No</label>
        </div>

        <button id="submitBtn" class="formbtns" onclick="createCaseFolder()">
          Submit
        </button>
        <div id="message"></div>
      </div>

      <div class="form-card">
        <h2>Generate Document Narrative</h2>
        <label for="docType">Select Doc Type</label>
        <select class="case-input" id="docType" required>
          <option value="" disabled selected>Select an option</option>
          <!-- <option value="colo">
            Focalentity Due Deligence No Results Matched
          </option> -->
          <option
            value="Focal entity name match, age match, address match, phone number
            match"
          >
            Focal entity name match, age match, address match, phone number
            match
          </option>
          <option value="Focal entity SMB details">
            Focal entity SMB details
          </option>
          <option value="No OFAC Sanction Found for the focal entity">
            OFAC No Sanction Found
          </option>
          <option
            value="On the review of the below hits no Results found related to the focal entity."
          >
            Google Screening No Results Matched
          </option>
          <option
            value="On the review of the below hits no Adverse media or Negative news related to fincrime found related to the focal entity"
          >
            Google Screening No Negative news
          </option>
        </select>
        <button id="generatebtn" class="formbtns" onclick="generateNarrative()">
          Submit
        </button>

        <div id="narrative-message"></div>
      </div>
    </div>
    <script>
      async function generateNarrative() {
        const narrativeMessage = document.getElementById("narrative-message");
        const text = document.getElementById("docType").value;
        if (!text) {
          narrativeMessage.textContent = "Please enter text to add to the PDF.";
          return;
        }
        // Code Generated by Sidekick is for learning and experimentation purposes only.
        try {
          let fileHandle, file, fileName;
          if (window.showOpenFilePicker) {
            [fileHandle] = await window.showOpenFilePicker({
              types: [
                {
                  description: "PDF Files",
                  accept: { "application/pdf": [".pdf"] },
                },
              ],
              excludeAcceptAllOption: true,
              multiple: false,
            });

            file = await fileHandle.getFile();
            fileName = file.name;
          } else {
            narrativeMessage.textContent =
              "This feature requires a Chromium browser (Chrome, Edge, Brave, etc).";
            return;
          }

          if (!file) {
            narrativeMessage.textContent = "No PDF selected.";
            return;
          }

          const arrayBuffer = await file.arrayBuffer();
          const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
          const pages = pdfDoc.getPages();
          const firstPage = pages[0];
          const font = await pdfDoc.embedFont(
            PDFLib.StandardFonts.HelveticaBold
          );
          const fontSize = 16;
          const textWidth = font.widthOfTextAtSize(text, fontSize);
          const { width, height } = firstPage.getSize();

          firstPage.drawText(text, {
            x: width - textWidth - 20,
            y: height - fontSize - 20,
            size: fontSize,
            font: font,
            color: PDFLib.rgb(1, 0, 0),
          });

          const pdfBytes = await pdfDoc.save();

          // Overwrite the original file
          const writable = await fileHandle.createWritable();
          await writable.write(pdfBytes);
          await writable.close();
          narrativeMessage.classList.add("success");
          narrativeMessage.textContent =
            "PDF updated and saved in the original file.";
        } catch (err) {
          message.classList.add("error");
          narrativeMessage.textContent = "Error: " + err.narrativeMessage;
        }
      }

      // case name logic
      async function createCaseFolder(params) {
        const caseId = document.getElementById("caseId").value.trim();
        const counterParty = document.querySelector(
          'input[name="counterParty"]:checked'
        ).value;
        const message = document.getElementById("message");
        message.textContent = "";
        if (!caseId) {
          message.textContent = "Please enter a Case ID.";
          return;
        }

        if ("showDirectoryPicker" in window) {
          try {
            const dirHandle = await window.showDirectoryPicker();
            const caseFolder = await dirHandle.getDirectoryHandle(
              `Case_${caseId}`,
              {
                create: true,
              }
            );
            await caseFolder.getDirectoryHandle("Focal_Entity", {
              create: true,
            });
            // await caseFolder.getDirectoryHandle("OFAC_Focal_Entity", {
            //   create: true,
            // });
            // await caseFolder.getDirectoryHandle("Screening_Focal_Entity", {
            //   create: true,
            // });
            const fileHandle = await caseFolder.getFileHandle(
              "Customer_Info.txt",
              { create: true }
            );
            const writable = await fileHandle.createWritable();
            await writable.write("");
            await writable.close();

            const docxHandle = await caseFolder.getFileHandle(
              `${caseId}_Summary.docx`,
              {
                create: true,
              }
            );
            const docxWritable = await docxHandle.createWritable();
            await docxWritable.write("");
            await docxWritable.close();
            if (counterParty === "yes") {
              await caseFolder.getDirectoryHandle("Counter_party", {
                create: true,
              });
              // await caseFolder.getDirectoryHandle("OFAC_Counter_party", {
              //   create: true,
              // });
              // await caseFolder.getDirectoryHandle("Screening_Counter_party", {
              //   create: true,
              // });
            }
            message.classList.add("success");
            message.textContent = `Folder "${caseId}", subfolders, and "Customer_Info.txt" created successfully!`;
          } catch (err) {
            if (err.name !== "AbortError") {
              message.textContent = "Error: " + err.message;
            }
          }
        } else {
          message.classList.add("error");
          message.textContent =
            "File System Access API is not supported in this browser.";
        }
      }
    </script>
  </body>
</html>
